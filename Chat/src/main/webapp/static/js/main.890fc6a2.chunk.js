(this.webpackJsonpstarter=this.webpackJsonpstarter||[]).push([[0],{1076:function(e,t,a){},1079:function(e,t,a){"use strict";a.r(t);var r=a(1),n=a.n(r),s=a(8),o=a.n(s),c=a(137),i=a(105),u=a(121),l=a(483),d=a(37),p=a(78),m=a(485),h=a.n(m),f=a(1093),g=function(e){return sessionStorage.setItem("userId",e)},v=function(){return sessionStorage.getItem("userId")},E=function(e){return sessionStorage.setItem("jwt",e)},b=function(){return sessionStorage.getItem("jwt")},y=function(){return sessionStorage.clear()},O=function(e){return null==e||""===e},S=function(){return O(b())},w="ws://localhost:8090/",j=h.a.create({baseURL:"http://localhost:8080"});j.interceptors.request.use((function(e){return e}),(function(e){return Promise.reject(e)})),j.interceptors.response.use((function(e){return e}),(function(e){return e.request.responseURL.endsWith("API/protected/ping")||(e.response.data.error.message?f.a.error(e.response.data.error.message):f.a.error("Ooops, The server was unable to complete your request. We will be back soon :(")),Promise.reject(e)}));var C={get:function(e){var t=O(b())?"":"".concat("Bearer"," ").concat(t);return j.get("".concat(e),{headers:{Authorization:t}})},post:function(e,t){var a=O(b())?"":"".concat("Bearer"," ").concat(a);return j.post("".concat(e),t,{headers:{Authorization:a}})},put:function(e,t){return j.put("".concat(e),t)},patch:function(e,t){return j.patch("".concat(e),t)},delete:function(e){return j.delete("".concat(e))}},k=a(487),N=a(72),I=a.n(N),P=a(488),A="addressBook.ADDRESSBOOK_FETCHED",L="addressBook.ADD_FRIEND_FAIL",T="addressBook.ADD_FRIEND",R="addressBook.ADD_FRIEND_POPUP_STATE",D="addressBook.EMPTY";function _(){return function(e){return new Promise((function(e){C.get("/API/protected/addressbook").then((function(t){for(var a=t.data.data.items,r=[],n=[],s=[],o=0;o<a.length;++o){var c={name:a[o].name,userId:a[o].userId,avatar:x(a[o].name),status:a[o].status,isOnline:a[o].online};a[o].online?n.push(c):s.push(c),M(n,s),r=n.concat(s)}e(r)}))})).then((function(t){e(function(e){var t=e,a=Bt.getState().addressBookReducer.newAddressBookList;return{type:A,fetchedAddressBookList:t,fetchedNewAddressBookList:a}}(t))}))}}function B(e){return function(t){C.post("/API/protected/sessionidbyuserid",function(e){return{userId:e}}(e)).then((function(a){t(function(e,t){"-1"!==e.data.data.sessionId?Bt.dispatch(ve(e.data.data.sessionId)):Bt.dispatch(function(e){var t=[e];return console.log(e),{type:re,messageItems:[],waitingGroupUsernames:t,currentSessionId:"-1"}}(t));return{type:D}}(a,e))}))}}function F(e){if(O(e)){return{type:L,error:"Please input username :("}}return function(t){return C.post("/API/protected/addfriend",(a=e,{username:a})).then((function(e){t(function(e){if(e.data.error){var t=e.data.error.message;return{type:L,error:t}}var a=I()(Bt.getState().addressBookReducer.newAddressBookList),r={name:e.data.data.item.name,userId:e.data.data.item.userId,avatar:x(e.data.data.item.name),status:e.data.data.item.status,isOnline:e.data.data.item.online};return a.push(r),{type:T,newAddressBookList:a}}(e))}));var a}}function G(e,t){for(var a=I()(Bt.getState().addressBookReducer.addressBookList),r=I()(Bt.getState().addressBookReducer.newAddressBookList),n=0;n<a.length;n++)a[n].userId===e&&(a[n].isOnline=t);for(var s=0;s<r.length;s++)r[s].userId===e&&(r[s].isOnline=t);for(var o=[],c=[],i=0;i<a.length;++i)a[i].isOnline?o.push(a[i]):c.push(a[i]);return M(o,c),a=o.concat(c),{type:A,fetchedAddressBookList:a,fetchedNewAddressBookList:r}}function x(e){return e.charAt(0)+" "+e.charAt(1)}function M(e,t){var a=function(e,t){return e.name<t.name?-1:e.name>t.name?1:0};e.sort(a),t.sort(a)}var U=a(24),H=a(26),K=a(25),W=a(27),z=a(1094),q=a(88),Y=new(function(e){function t(){var e,a;Object(U.a)(this,t);for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return(a=Object(H.a)(this,(e=Object(K.a)(t)).call.apply(e,[this].concat(s)))).onlineNotification=function(e){return z.a.open({description:"".concat(e," is Online"),className:"online-notification",icon:n.a.createElement(q.a,{name:a.processUsernameForAvatar(e),className:"notification-icon",size:"30"})})},a.offlineNotification=function(e){return z.a.open({description:"".concat(e," is Offline"),className:"offline-notification",icon:n.a.createElement(q.a,{name:a.processUsernameForAvatar(e),className:"notification-icon",size:"30"})})},a.processUsernameForAvatar=function(e){return"".concat(e.charAt(0)," ").concat(e.charAt(1))},a}return Object(W.a)(t,e),t}(n.a.Component)),V="chatlist.EMPTY",J="chatlist.CHATLIST_FETCHED",Q="chatlist.CHATLIST_REFETCHED",X="chatlist.MESSAGE_HEADER_FETCHED",Z="chatlist.MESSAGE_PANEL_FETCHED",$="chatlist.NEW_MESSAGE_IN_PANEL_FETCHED",ee="chatlist.ADD_NEW_START_CHAT_GROUP",te="chatlist.REMOVE_START_CHAT_GROUP",ae="chatlist.START_CHAT_GROUP",re="chatlist.START_CHAT_SINGLE",ne="chatlist.ADD_NEW_START_CHAT_GROUP_FAIL",se="chatlist.USER_SELECTED",oe="chatlist.WEBSOCKET_FETCHED",ce=function(e){return"".concat(e.charAt(0)," ").concat(e.charAt(1))},ie=function(e){for(var t=v(),a=[],r=0;r<e.length;r++){var n=1;e[r].userId!==t&&(n=2);var s=!0;r>0&&a[r-1].type===n&&a[r-1].userId===e[r].userId&&(s=!1);var o={message:e[r].message,type:n,showavatar:s,avatar:ce(e[r].name),userId:e[r].userId,createdDate:new Date(e[r].createdDate).toLocaleString()};a.push(o)}return a.reverse(),a},ue=function(){return new Promise((function(e){C.get("/API/protected/chatlist").then((function(t){for(var a=t.data.data.items,r=[],n=0;n<a.length;++n){var s={name:a[n].name,sessionId:a[n].sessionId,avatar:ce(a[n].name),lastMessage:a[n].lastMessage,unread:a[n].unread,groupchat:a[n].groupChat,updatedDate:a[n].updatedDate};r.push(s)}r.sort((function(e,t){return e.updatedDate<t.updatedDate?1:e.updatedDate>t.updatedDate?-1:0})),e(r)}))}))},le=function(e){return{type:"CHAT_ITEMS_REQUEST",sessionId:e}},de=function(e,t,a){return{type:"CHAT_MESSAGE_REQUEST",sessionId:e,message:t,usernames:a,groupChat:"-1"===e}},pe=function(e){return{username:e}},me=function(e){return{usernames:e}};function he(){var e=b(),t=new k.a(w+"?jwt="+e,{timeout:5e3,maxAttempts:10,onopen:function(){},onmessage:function(e){var t=JSON.parse(e.data);switch(t.type){case"CHAT_ITEMS_RESPONSE":Bt.dispatch(function(e,t){var a=ie(e),r=[];if(Bt.getState().chatReducer.chatList.length>0){r=I()(Bt.getState().chatReducer.chatList);for(var n=0;n<r.length;n++)r[n].sessionId===t&&(r[n].unread=0);Bt.dispatch(ye(t))}return{type:Z,messageItems:a,currentSessionId:t,chatList:r}}(t.chatItems,t.sessionId));break;case"CHAT_MESSAGE_RESPONSE":Bt.dispatch(function(e){var t=Bt.getState().chatReducer.currentSessionId,a=v(),r=Bt.getState().chatReducer.userSelected,n=[];Bt.getState().chatReducer.messageItems.length>0&&(n=I()(Bt.getState().chatReducer.messageItems));var s=[];Bt.getState().chatReducer.chatList.length>0&&(s=I()(Bt.getState().chatReducer.chatList));if(t===e.sessionId){var o=1;e.userId!==a&&(o=2);var c=!0;n.length>0&&n[0].type===o&&n[0].userId===e.userId&&(c=!1);var i={message:e.message,type:o,showavatar:c,avatar:ce(e.name),userId:e.userId,createdDate:new Date(e.createdDate).toLocaleString()};n.unshift(i);for(var u=0;u<s.length;u++)if(s[u].sessionId===e.sessionId){r=e.sessionId,s[u].lastMessage=e.message;var l=s[u];s.splice(u,1),s.unshift(l);break}}else for(var d=0;d<s.length;d++)if(s[d].sessionId===e.sessionId){s[d].lastMessage=e.message,s[d].unread=s[d].unread+1;var p=s[d];s.splice(d,1),s.unshift(p);break}return{type:$,messageItems:n,chatList:s,userSelected:r}}(t));break;case"CHAT_NEW_SESSION_RESPONSE":Bt.dispatch(function(e){"-1"===Bt.getState().chatReducer.currentSessionId&&Bt.dispatch(ve(e.sessionId));return Bt.dispatch(function(){return function(e){return ue().then((function(t){e({type:Q,fetchedChatlist:t})}))}}()),Bt.dispatch(ye(e.sessionId)),{type:V}}(t));break;case"USER_ONLINE_RESPONSE":Bt.dispatch(function(e){var t=e.userId,a=e.fullName;return Y.onlineNotification(a),Bt.dispatch(G(t,!0)),{type:V}}(t));break;case"USER_OFFLINE_RESPONSE":Bt.dispatch(function(e){var t=e.userId,a=e.fullName;return Y.offlineNotification(a),Bt.dispatch(G(t,!1)),{type:V}}(t))}},onreconnect:function(e){return console.log("Reconnecting...",e)},onmaximum:function(e){return console.log("Stop Attempting!",e)},onclose:function(e){return console.log("Closed!",e)},onerror:function(e){return console.log("Error:",e)}});return{type:oe,webSocket:t}}function fe(){return Bt.getState().chatReducer.webSocket.close(),{type:V}}function ge(){return function(e){return ue().then((function(t){e(function(e){var t=e,a={};t.length>0&&(a={title:t[0].name,avatar:t[0].avatar,groupchat:t[0].groupchat},Bt.dispatch(function(e){var t=[];return function(){try{if(Bt.getState().chatReducer.webSocket.json(le(e)),Bt.getState().chatReducer.chatList.length<=0)return;t=I()(Bt.getState().chatReducer.chatList);for(var a=0;a<t.length;a++)t[a].sessionId===e&&(t[a].unread=0)}catch(r){setTimeout((function(){console.log(r)}),500)}}(),{type:V}}(t[0].sessionId)));return{type:J,fetchedChatlist:t,messageHeader:a}}(t))}))}}function ve(e){return Bt.getState().chatReducer.webSocket.json(le(e)),{type:V}}function Ee(e,t,a){return{type:X,messageHeader:{title:e,avatar:t,groupchat:a}}}function be(e){if(O(e)){return{type:ne,error:"Please input username :("}}return function(t){return C.post("/API/protected/usernameexisted",pe(e)).then((function(e){t(function(e){if(!e.data.data.existed){return{type:ne,error:"Username is not existed :("}}var t=I()(Bt.getState().chatReducer.startChatGroupList);return t.push(e.data.data.username),{type:ee,startChatGroupList:t}}(e))}))}}function ye(e){return console.log(e),{type:se,userSelectedKeys:[e]}}function Oe(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Se(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Oe(Object(a),!0).forEach((function(t){Object(p.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Oe(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var we={chatList:[],messageItems:[],messageHeader:{},webSocket:null,currentSessionId:null,startChatGroupList:[],startChatGroupError:!1,startChatGroupErrorMessage:"",waitingGroupUsernames:[],userSelectedKeys:[]};function je(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Ce(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?je(Object(a),!0).forEach((function(t){Object(p.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):je(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var ke={addressBookList:[],newAddressBookList:[],addFriendError:!1,addFriendErrorMessage:"",addFriendPopup:!1};var Ne="portal.CHANGE_TAB",Ie="user.REGISTER_SUCCEEDED",Pe="user.USER_PROFILE",Ae="user.CHANGE_STATUS";function Le(e){return function(t){return function(e){return new Promise((function(t){C.post("/API/public/user",e).then((function(e){return t(e)}))}))}(e).then((function(e){t(function(e){return f.a.success("Register successfully. You can proceed to login with your account :)"),{type:Ie,user:e}}(e.data))}))}}function Te(){return function(e){return C.get("/API/protected/user").then((function(t){e(function(e){var t="You are online";return""!==e.data.data.status&&(t=e.data.data.status),{type:Pe,userName:e.data.data.userName,userFullName:e.data.data.userFullName,userStatus:t}}(t))}))}}function Re(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function De(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Re(Object(a),!0).forEach((function(t){Object(p.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Re(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var _e={user:{},activeTabKey:"1",userFullName:"",userName:"",userStatus:""};var Be=Object(u.c)({chatReducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:we,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case J:return Se({},e,{chatList:t.fetchedChatlist,messageHeader:t.messageHeader});case Q:return Se({},e,{chatList:t.fetchedChatlist});case se:return Se({},e,{userSelectedKeys:t.userSelectedKeys});case ne:return Se({},e,{startChatGroupError:!0,startChatGroupErrorMessage:t.error});case ee:return Se({},e,{startChatGroupError:!1,startChatGroupErrorMessage:"",startChatGroupList:t.startChatGroupList});case te:return Se({},e,{startChatGroupList:t.startChatGroupList});case ae:return Se({},e,{messageItems:t.messageItems,waitingGroupUsernames:t.waitingGroupUsernames,currentSessionId:t.currentSessionId,startChatGroupList:[]});case re:return Se({},e,{messageItems:t.messageItems,waitingGroupUsernames:t.waitingGroupUsernames,currentSessionId:t.currentSessionId});case Z:return Se({},e,{messageItems:t.messageItems,waitingGroupUsernames:[],currentSessionId:t.currentSessionId,chatList:t.chatList,userSelected:t.userSelected});case $:return Se({},e,{messageItems:t.messageItems,chatList:t.chatList});case X:return Se({},e,{messageHeader:t.messageHeader});case oe:return Se({},e,{webSocket:t.webSocket});default:return e}},addressBookReducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ke,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case A:return Ce({},e,{addressBookList:t.fetchedAddressBookList,newAddressBookList:t.fetchedNewAddressBookList});case T:return Ce({},e,{addFriendError:!1,addFriendErrorMessage:"",newAddressBookList:t.newAddressBookList,addFriendPopup:!1});case L:return Ce({},e,{addFriendError:!0,addFriendErrorMessage:t.error});case R:return Ce({},e,{addFriendPopup:t.popupstate});default:return e}},userReducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_e,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Ne:return console.log(t.activeTabKey),De({},e,{activeTabKey:t.activeTabKey.toString()});case Ie:return De({},e,{user:t.user,activeTabKey:"1"});case Pe:return De({},e,{userFullName:t.userFullName,userName:t.userName,userStatus:t.userStatus});case Ae:return De({},e,{userStatus:t.userStatus});default:return e}}}),Fe=function(e,t){return"USER_LOGOUT"===t.type&&(e=void 0),Be(e,t)},Ge=a(44),xe=a(1098),Me=a(1096),Ue=a(1097),He=a(17),Ke=a(104),We=Me.a.Item,ze=function(e){function t(e){var a;return Object(U.a)(this,t),(a=Object(H.a)(this,Object(K.a)(t).call(this,e))).handleSubmit=function(e){e.preventDefault(),a.props.form.validateFields((function(e,t){e||C.post("/signin",t).then((function(e){E(e.data.data.jwt),g(e.data.data.userId),a.props.history.push("/")}))}))},a.state={serverValidation:{visible:!1,validateStatus:"error",errorMsg:"Invalid username or password!"}},a}return Object(W.a)(t,e),Object(Ge.a)(t,[{key:"render",value:function(){var e=this.props.form.getFieldDecorator,t=this.state.serverValidation;return n.a.createElement(Me.a,{onSubmit:this.handleSubmit,className:"login-form"},n.a.createElement(We,null,e("userName",{rules:[{required:!0,message:"Please input your username!"}]})(n.a.createElement(Ue.a,{prefix:n.a.createElement(He.a,{type:"user",style:{color:"rgba(0,0,0,.25)"}}),placeholder:"Username"}))),n.a.createElement(We,null,e("password",{rules:[{required:!0,message:"Please input your Password!"}]})(n.a.createElement(Ue.a,{prefix:n.a.createElement(He.a,{type:"lock",style:{color:"rgba(0,0,0,.25)"}}),type:"password",placeholder:"Password"}))),t.visible&&n.a.createElement(We,{validateStatus:t.validateStatus,help:t.errorMsg}),n.a.createElement(We,null,n.a.createElement(Ke.a,{type:"primary",htmlType:"submit",className:"login-form-button"},"Log in")))}}]),t}(n.a.Component),qe=Object(i.f)(Me.a.create()(ze)),Ye=Me.a.Item,Ve=function(e){function t(){var e,a;Object(U.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(H.a)(this,(e=Object(K.a)(t)).call.apply(e,[this].concat(n)))).state={confirmDirty:!1},a.handleSubmit=function(e){e.preventDefault(),a.props.form.validateFields((function(e,t){if(!e){console.log("Received values of form: ",t);var r={fullName:t.fullName,userName:t.userName,password:t.password};a.props.register(r)}}))},a.handleConfirmBlur=function(e){var t=e.target.value;a.setState({confirmDirty:a.state.confirmDirty||!!t})},a.compareToFirstPassword=function(e,t,r){var n=a.props.form;t&&t!==n.getFieldValue("password")?r("Two passwords that you enter is inconsistent!"):r()},a.validateToNextPassword=function(e,t,r){var n=a.props.form;t&&a.state.confirmDirty&&n.validateFields(["rePassword"],{force:!0}),r()},a}return Object(W.a)(t,e),Object(Ge.a)(t,[{key:"render",value:function(){var e=this.props.form.getFieldDecorator;return n.a.createElement(Me.a,{onSubmit:this.handleSubmit,className:"login-form"},n.a.createElement(Ye,null,e("fullName",{rules:[{required:!0,message:"Please input your Full Name!"}]})(n.a.createElement(Ue.a,{prefix:n.a.createElement(He.a,{type:"idcard",style:{color:"rgba(0,0,0,.25)"}}),placeholder:"Fullname"}))),n.a.createElement(Ye,null,e("userName",{rules:[{required:!0,message:"Please choose your username!"}]})(n.a.createElement(Ue.a,{prefix:n.a.createElement(He.a,{type:"user",style:{color:"rgba(0,0,0,.25)"}}),placeholder:"Username"}))),n.a.createElement(Ye,null,e("password",{rules:[{required:!0,message:"Please input your Password!"},{validator:this.validateToNextPassword}]})(n.a.createElement(Ue.a,{prefix:n.a.createElement(He.a,{type:"lock",style:{color:"rgba(0,0,0,.25)"}}),type:"password",placeholder:"Password"}))),n.a.createElement(Ye,null,e("rePassword",{rules:[{required:!0,message:"Please re-input your Password!"},{validator:this.compareToFirstPassword}]})(n.a.createElement(Ue.a,{prefix:n.a.createElement(He.a,{type:"lock",style:{color:"rgba(0,0,0,.25)"}}),type:"password",placeholder:"Confirm Password",onBlur:this.handleConfirmBlur}))),n.a.createElement(Ye,null,n.a.createElement(Ke.a,{type:"primary",htmlType:"submit",className:"login-form-button"},"Register")))}}]),t}(n.a.Component),Je=Object(d.b)((function(e){return{user:e.userReducer.user}}),(function(e){return{register:function(t){return e(Le(t))}}}))(Me.a.create()(Ve)),Qe=xe.a.TabPane,Xe=function(e){function t(){var e,a;Object(U.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(H.a)(this,(e=Object(K.a)(t)).call.apply(e,[this].concat(n)))).handleTabChanged=function(e){return a.props.changeTab(e)},a}return Object(W.a)(t,e),Object(Ge.a)(t,[{key:"render",value:function(){return S()?n.a.createElement("div",{id:"portal-container"},n.a.createElement("div",{className:"logo"},n.a.createElement("img",{src:"logo.png",alt:"logo.png"})),n.a.createElement("div",{id:"authen-panel"},n.a.createElement(xe.a,{activeKey:this.props.activeTabKey,onChange:this.handleTabChanged},n.a.createElement(Qe,{tab:"Login",key:"1"},n.a.createElement(qe,null)),n.a.createElement(Qe,{tab:"Register",key:"2"},n.a.createElement(Je,null))))):n.a.createElement(i.a,{to:"/"})}}]),t}(n.a.Component),Ze=Object(d.b)((function(e){return{activeTabKey:e.userReducer.activeTabKey}}),(function(e){return{changeTab:function(t){return e({type:Ne,activeTabKey:t})}}}))(Xe),$e=a(143),et=a.n($e),tt=a(1095),at=a(1099);function rt(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function nt(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?rt(Object(a),!0).forEach((function(t){Object(p.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):rt(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var st=function(e){function t(e){var a;return Object(U.a)(this,t),(a=Object(H.a)(this,Object(K.a)(t).call(this,e))).componentDidMount=function(){a.props.getProfile(),a.setState(nt({},a.state,{status_text:a.props.userStatus}))},a.componentDidUpdate=function(){O(a.state.status_text)&&a.state.status_box_state&&(a.state.status_text="You are online",a.setState(nt({},a.state,{status_text:a.state.status_text}))),a.refs.statusInput&&a.refs.statusInput.focus()},a.logOut=function(){return C.post("/signout").then((function(e){y(),a.props.closeWebSocket(),a.props.logout(),a.props.history.push("/login")}))},a.openStatusBoxStateStatus=function(){a.state.status_text="You are online"===a.props.userStatus?"":a.props.userStatus,a.setState(nt({},a.state,{status_box_state:!1,status_text:a.state.status_text}))},a.closeStatusBoxStateStatus=function(){a.props.changeUserStatus(a.state.status_text),a.setState(nt({},a.state,{status_box_state:!0}))},a.onChangeStatus=function(e){return a.setState(nt({},a.state,{status_text:e.target.value}))},a.render=function(){return n.a.createElement("div",{className:"wrapper"},n.a.createElement("div",{className:"profile-left"},n.a.createElement("div",{className:"box user-name"},"Hey! - ",a.props.userFullName),n.a.createElement("div",{className:"box status"},a.state.status_box_state?n.a.createElement("div",{onClick:a.openStatusBoxStateStatus},a.props.userStatus):n.a.createElement(Ue.a,{onBlur:a.closeStatusBoxStateStatus,onPressEnter:a.closeStatusBoxStateStatus,placeholder:"Please enter a status...",value:a.state.status_text,ref:"statusInput",onChange:a.onChangeStatus}))),n.a.createElement("div",{className:"profile-right logout"},n.a.createElement("a",{href:"#",className:"logout-a",onClick:a.logOut},n.a.createElement(He.a,{type:"logout",style:{fontSize:36,color:"#444"}}))))},a.state={status_box_state:!0},a}return Object(W.a)(t,e),t}(n.a.Component),ot=Object(d.b)((function(e){return{userFullName:e.userReducer.userFullName,userName:e.userReducer.userName,userStatus:e.userReducer.userStatus}}),(function(e){return{changeUserStatus:function(t){return e(function(e){var t="You are online";return""!==e&&(t=e),C.post("/API/protected/status",function(e){return{status:e}}(e)),{type:Ae,userStatus:t}}(t))},getProfile:function(){return e(Te())},logout:function(){return e({type:"USER_LOGOUT"})},closeWebSocket:function(){return e(fe())}}}))(Object(i.f)(st)),ct=a(212),it=a(501),ut=a.n(it),lt=function(e){function t(){var e,a;Object(U.a)(this,t);for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return(a=Object(H.a)(this,(e=Object(K.a)(t)).call.apply(e,[this].concat(s)))).render=function(){return n.a.createElement("div",{className:"friend-avatar"})},a}return Object(W.a)(t,e),t}(n.a.Component),dt=(n.a.Component,function(e){function t(){return Object(U.a)(this,t),Object(H.a)(this,Object(K.a)(t).apply(this,arguments))}return Object(W.a)(t,e),Object(Ge.a)(t,[{key:"render",value:function(){var e=this.props,t=e.avatar,a=e.type,r="custom-avatar ".concat(a);switch(this.props.type){case"main-avatar":return n.a.createElement(ut.a,{email:"".concat(t,"@gmail.com"),className:r,default:"identicon"});case"new-avatar":return n.a.createElement(lt,{icon:"plus",className:r,style:{fontSize:30}});case"panel-avatar":return n.a.createElement(q.a,{name:t,className:r,size:"50"});case"panel-group-avatar":return n.a.createElement(q.a,{name:"G",color:"#001529",className:r,size:"50"});case"user-avatar":return n.a.createElement(q.a,{name:t,className:r,size:"60"});case"group-avatar":return n.a.createElement(q.a,{name:"G",color:"#001529",className:r,size:"60"});case"chat-avatar":return this.props.show?n.a.createElement(q.a,{name:t,className:r,size:"40"}):n.a.createElement("div",{className:"mock-small-avatar"});default:return n.a.createElement(lt,{className:r})}}}]),t}(n.a.Component)),pt=(n.a.Component,a(1100)),mt=a(1102),ht=a(1101),ft=function(e){function t(e){var a;return Object(U.a)(this,t),(a=Object(H.a)(this,Object(K.a)(t).call(this,e))).showModal=function(){return a.setState({visible:!0})},a.handleOk=function(){a.setState({visible:!1}),a.props.startNewChatGroup()},a.handleCancel=function(){return a.setState({visible:!1})},a.addMoreUsername=function(){var e=et()("#add-user-name");a.props.addNewUserChatGroup(e.val()),e.val("")},a.handleRemoveUsername=function(e){return a.props.removeUserChatGroup(e)},a.render=function(){return n.a.createElement("div",null,n.a.createElement("div",{className:"new-action-menu",onClick:a.showModal},n.a.createElement("a",{href:"#"},n.a.createElement(dt,{type:"new-avatar"}),n.a.createElement("div",{className:"new-text"},"Start New Group Chat"))),n.a.createElement(pt.a,{width:"420px",title:"Start New Chat Group",visible:a.state.visible,onOk:a.handleOk,onCancel:a.handleCancel,okText:"Start",cancelText:"Cancel",className:"start-chat-group-modal"},a.props.startChatGroupError&&n.a.createElement(mt.a,{message:a.props.startChatGroupErrorMessage,type:"error"}),n.a.createElement("p",{className:"model-label"},"Please enter user name:"),n.a.createElement("div",{className:"first-line"},n.a.createElement(Ue.a,{ref:function(e){a.ref=e},id:"add-user-name",className:"add-user-name",onPressEnter:a.addMoreUsername}),n.a.createElement(Ke.a,{onClick:a.addMoreUsername,type:"primary",shape:"circle",icon:"plus"})),a.props.startChatGroupList.length>0&&n.a.createElement("p",{className:"model-label",style:{marginBottom:3,marginTop:10}},"Selected:"),a.props.startChatGroupList.map((function(e,t){return n.a.createElement(ht.a,{key:t,closable:!0,onClose:function(t){a.handleRemoveUsername(e),t.preventDefault()},color:"#f50"},e)}))))},a.state={visible:!1},a}return Object(W.a)(t,e),t}(n.a.Component),gt=Object(d.b)((function(e){return{startChatGroupList:e.chatReducer.startChatGroupList,startChatGroupError:e.chatReducer.startChatGroupError,startChatGroupErrorMessage:e.chatReducer.startChatGroupErrorMessage}}),(function(e){return{addNewUserChatGroup:function(t){return e(be(t))},removeUserChatGroup:function(t){return e(function(e){var t=I()(Bt.getState().chatReducer.startChatGroupList),a=t.indexOf(e);return a>-1&&t.splice(a,1),{type:te,startChatGroupList:t}}(t))},startNewChatGroup:function(){return e(function(){if(Bt.getState().chatReducer.startChatGroupList.length<=1)return P.message.error("Sorry, but a group chat must contains more than 2 people :("),{type:V};var e=Bt.getState().chatReducer.startChatGroupList;return C.post("/API/protected/waitingchatheader",me(e)).then((function(e){Bt.dispatch(Ee(e.data.data.title,"",!0))})),{type:ae,messageItems:[],waitingGroupUsernames:e,currentSessionId:"-1"}}())}}}))(ft),vt=function(e){function t(e){var a;return Object(U.a)(this,t),(a=Object(H.a)(this,Object(K.a)(t).call(this,e))).componentDidMount=function(){return a.props.loadChatList()},a.handleChangeChatItem=function(e){a.props.userSelected(e.key),a.props.loadChatContainer(e.key);for(var t=0;t<a.props.chatList.length;t++){var r=a.props.chatList[t];r.sessionId===e.key&&a.props.changeMessageHeader(r.name,r.avatar,r.groupchat)}},a.state={menuaction:1},a}return Object(W.a)(t,e),Object(Ge.a)(t,[{key:"render",value:function(){return this.props.chatList?n.a.createElement("div",{className:"d-flex flex-column full-height"},n.a.createElement(gt,null),n.a.createElement(ct.Scrollbars,{autoHide:!0,autoHideTimeout:500,autoHideDuration:200},n.a.createElement(at.a,{theme:"light",mode:"inline",className:"chat-list",onSelect:this.handleChangeChatItem,selectedKeys:this.props.userSelectedKeys},this.props.chatList.map((function(e,t){return n.a.createElement(at.a.Item,{key:e.sessionId},n.a.createElement("div",{style:{width:60}},e.groupchat?n.a.createElement(dt,{type:"group-avatar"}):n.a.createElement(dt,{type:"user-avatar",avatar:e.avatar})),e.unread>0?n.a.createElement("div",{className:"unread-item",style:{overflow:"hidden",paddingTop:5}},n.a.createElement("div",{className:"user-name"},e.name),n.a.createElement("div",{className:"history-message"},e.lastMessage)):n.a.createElement("div",{style:{overflow:"hidden",paddingTop:5}},n.a.createElement("div",{className:"user-name"},e.name),n.a.createElement("div",{className:"history-message"},e.lastMessage)),e.unread>0?n.a.createElement("div",{className:"unread"},e.unread):"")}))))):"Loading..."}}]),t}(n.a.Component),Et=Object(d.b)((function(e){return{chatList:e.chatReducer.chatList,userSelectedKeys:e.chatReducer.userSelectedKeys}}),(function(e){return{loadChatList:function(){return e(ge())},loadChatContainer:function(t){return e(ve(t))},changeMessageHeader:function(t,a,r){return e(Ee(t,a,r))},userSelected:function(t){return e(ye(t))}}}))(vt),bt=function(e){function t(){var e,a;Object(U.a)(this,t);for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return(a=Object(H.a)(this,(e=Object(K.a)(t)).call.apply(e,[this].concat(s)))).render=function(){return n.a.createElement("div",{className:"chat-header"},n.a.createElement("div",{style:{width:50}},a.props.header.groupchat?n.a.createElement(dt,{type:"panel-group-avatar"}):n.a.createElement(dt,{type:"panel-avatar",avatar:a.props.header.avatar})),n.a.createElement("div",{style:{overflow:"hidden",paddingTop:5}},n.a.createElement("div",{className:"panel-message"},a.props.header.title)))},a}return Object(W.a)(t,e),t}(n.a.Component),yt=Object(d.b)((function(e){return{header:e.chatReducer.messageHeader}}),(function(){return{}}))(bt),Ot=a(166),St=function(e){function t(e){var a;return Object(U.a)(this,t),(a=Object(H.a)(this,Object(K.a)(t).call(this,e))).handleOk=function(e){console.log(e);var t=et()("#add-user-name"),r=t.val();t.val(""),a.props.addNewFriend(r)},a.handleCancel=function(){return a.props.changeStateAddFriendPopup(!1)},a.showModal=function(){return a.props.changeStateAddFriendPopup(!0)},a.state={visible:!1},a}return Object(W.a)(t,e),Object(Ge.a)(t,[{key:"render",value:function(){return n.a.createElement("div",null,n.a.createElement("div",{className:"new-action-menu",onClick:this.showModal},n.a.createElement("a",{href:"#"},n.a.createElement(dt,{type:"new-avatar"}),n.a.createElement("div",{className:"new-text"},"Add New Friend"))),n.a.createElement(pt.a,{title:"Add New Friend",okText:"Add",cancelText:"Cancel",width:"420px",visible:this.props.addFriendPopup,onOk:this.handleOk,onCancel:this.handleCancel},this.props.addFriendError&&n.a.createElement(mt.a,{message:this.props.addFriendErrorMessage,type:"error"}),n.a.createElement("p",{className:"model-label"},"Please enter user name:"),n.a.createElement(Ue.a,{id:"add-user-name",className:"add-user-name",onPressEnter:this.handleOk})))}}]),t}(n.a.Component);var wt=Object(d.b)((function(e){return{addFriendError:e.addressBookReducer.addFriendError,addFriendErrorMessage:e.addressBookReducer.addFriendErrorMessage,addFriendPopup:e.addressBookReducer.addFriendPopup}}),(function(e){return{addNewFriend:function(t){return e(F(t))},changeStateAddFriendPopup:function(t){return e(function(e){return{type:R,popupstate:e}}(t))}}}))(St);function jt(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Ct(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?jt(Object(a),!0).forEach((function(t){Object(p.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):jt(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var kt=function(e){function t(e){var a;return Object(U.a)(this,t),(a=Object(H.a)(this,Object(K.a)(t).call(this,e))).state={current:[],newselect:[]},a.handleCurrentChange=a.handleCurrentChange.bind(Object(Ot.a)(a)),a.handleNewChange=a.handleNewChange.bind(Object(Ot.a)(a)),a}return Object(W.a)(t,e),Object(Ge.a)(t,[{key:"componentDidMount",value:function(){this.props.loadAddressBookList()}},{key:"handleCurrentChange",value:function(e){this.setState(Ct({},this.state,{current:[e.key],newselect:[]})),this.props.handleChangeAddressBook(this.props.addressBookList[e.key].userId),this.props.changeMessageHeader(this.props.addressBookList[e.key].name,this.props.addressBookList[e.key].avatar,!1)}},{key:"handleNewChange",value:function(e){this.setState(Ct({},this.state,{newselect:[e.key],current:[]})),console.log(e.key),this.props.handleChangeAddressBook(this.props.newAddressBookList[e.key].userId),this.props.changeMessageHeader(this.props.newAddressBookList[e.key].name,this.props.newAddressBookList[e.key].avatar,!1)}},{key:"render",value:function(){return n.a.createElement("div",{className:"d-flex flex-column full-height address-book-menu"},n.a.createElement(wt,null),n.a.createElement(ct.Scrollbars,{autoHide:!0,autoHideTimeout:500,autoHideDuration:200},this.props.newAddressBookList.length>0?n.a.createElement("div",null,n.a.createElement("hr",{className:"hr-sub-menu-title"}),n.a.createElement("div",{className:"sub-menu-title new-add"}," New Friends (",this.props.newAddressBookList.length,")"),n.a.createElement(at.a,{theme:"light",mode:"inline",defaultSelectedKeys:[],selectedKeys:this.state.newselect,className:"address-book new-address-book",onSelect:this.handleNewChange},this.props.newAddressBookList.map((function(e,t){return n.a.createElement(at.a.Item,{key:t},n.a.createElement("div",{style:{width:60}},n.a.createElement(dt,{type:"user-avatar",avatar:e.avatar})),e.isOnline?n.a.createElement("div",{className:"status-point online"}):n.a.createElement("div",{className:"status-point offline"}),n.a.createElement("div",{style:{overflow:"hidden",paddingTop:5}},n.a.createElement("div",{className:"user-name"},e.name),n.a.createElement("div",{className:"history-message"},e.status)))})))):"",n.a.createElement("hr",{className:"hr-sub-menu-title"}),n.a.createElement("div",{className:"sub-menu-title"},"Friends (",this.props.addressBookList.length,")"),n.a.createElement(at.a,{theme:"light",mode:"inline",defaultSelectedKeys:[],selectedKeys:this.state.current,className:"address-book",onSelect:this.handleCurrentChange},this.props.addressBookList.map((function(e,t){return n.a.createElement(at.a.Item,{key:t},n.a.createElement("div",{style:{width:60}},n.a.createElement(dt,{type:"user-avatar",avatar:e.avatar})),e.isOnline?n.a.createElement("div",{className:"status-point online"}):n.a.createElement("div",{className:"status-point offline"}),n.a.createElement("div",{style:{overflow:"hidden",paddingTop:5}},n.a.createElement("div",{className:"user-name"},e.name),n.a.createElement("div",{className:"history-message"},e.status)))})))))}}]),t}(n.a.Component);var Nt=Object(d.b)((function(e){return{addressBookList:e.addressBookReducer.addressBookList,newAddressBookList:e.addressBookReducer.newAddressBookList}}),(function(e){return{loadAddressBookList:function(){e(_())},changeMessageHeader:function(t,a,r){e(Ee(t,a,r))},handleChangeAddressBook:function(t){e(B(t))}}}))(kt),It=a(502),Pt=function(e){function t(e){var a;return Object(U.a)(this,t),(a=Object(H.a)(this,Object(K.a)(t).call(this,e))).handleItemClick=function(){return a.setState({showDate:!a.state.showDate})},a.state={showDate:!1},a}return Object(W.a)(t,e),Object(Ge.a)(t,[{key:"render",value:function(){var e=1===this.props.type?"chat-item-owner":"chat-item-other",t=1===this.props.type?"chat-item-content-owner":"chat-item-content-other";return n.a.createElement("div",{onClick:this.handleItemClick,className:"chat-item chat-item-outer ".concat(e)},n.a.createElement("div",{className:"chat-item ".concat(e)},n.a.createElement(dt,{type:"chat-avatar",avatar:this.props.avatar,show:this.props.showavatar}),n.a.createElement("div",{className:"chat-item-content ".concat(t)},this.props.value)),this.state.showDate&&n.a.createElement(It.SlideDown,null,n.a.createElement("div",{className:"chat-item-date"},this.props.date)))}}]),t}(n.a.Component),At=function(e){function t(){var e,a;Object(U.a)(this,t);for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return(a=Object(H.a)(this,(e=Object(K.a)(t)).call.apply(e,[this].concat(s)))).scrollToBottom=function(){return a.messagesEnd.scrollIntoView({behavior:"smooth"})},a.componentDidUpdate=function(){return a.scrollToBottom()},a.render=function(){return n.a.createElement("div",{className:"chat-content"},n.a.createElement("div",{ref:function(e){a.messagesEnd=e}}),a.props.messageItems.map((function(e,t){return n.a.createElement(Pt,{key:t,type:e.type,value:e.message,showavatar:e.showavatar,avatar:e.avatar,date:e.createdDate})})))},a}return Object(W.a)(t,e),t}(n.a.Component),Lt=Object(d.b)((function(e){return{messageItems:e.chatReducer.messageItems}}),(function(){return{}}))(At),Tt=tt.a.Sider,Rt=Ue.a.TextArea,Dt=function(e){function t(e){var a;return Object(U.a)(this,t),(a=Object(H.a)(this,Object(K.a)(t).call(this,e))).componentDidMount=function(){a.props.initialWebSocket()},a.componentWillUnmount=function(){},a.handleMainMenuChange=function(e){a.setState({menuaction:e.key})},a.handleMessageEnter=function(e){e.keyCode||e.which;if(!e.shiftKey){e.preventDefault();var t=e.target.value;O(t)||a.props.submitChatMessage(t),e.target.value=""}},a.handleSendClick=function(e){var t=et()("#messageTextArea"),r=t.val();O(r)||a.props.submitChatMessage(r),t.val("")},a.state={menuaction:1},a}return Object(W.a)(t,e),Object(Ge.a)(t,[{key:"render",value:function(){return S()?n.a.createElement(i.a,{to:"/login"}):n.a.createElement("div",{style:{height:"100vh"}},n.a.createElement(tt.a,null,n.a.createElement(Tt,{breakpoint:"lg",collapsedWidth:"0",onBreakpoint:function(){},onCollapse:function(){},width:"80",id:"main-side-menu"},n.a.createElement(dt,{type:"main-avatar",avatar:this.props.userName}),n.a.createElement("div",{className:"menu-separation"}),n.a.createElement(at.a,{theme:"dark",mode:"inline",defaultSelectedKeys:["1"],onSelect:this.handleMainMenuChange},n.a.createElement(at.a.Item,{key:"1"},n.a.createElement(He.a,{type:"message",style:{fontSize:30}})),n.a.createElement(at.a.Item,{key:"2"},n.a.createElement(He.a,{type:"bars",style:{fontSize:30}})))),n.a.createElement(Tt,{breakpoint:"lg",collapsedWidth:"0",theme:"light",onBreakpoint:function(){},onCollapse:function(){},width:"300",id:"sub-side-menu"},n.a.createElement(ot,null),n.a.createElement("div",{className:"menu-separation"}),1===this.state.menuaction?n.a.createElement(Et,null):n.a.createElement(Nt,null)),n.a.createElement("div",{className:"chat-container",style:{padding:0}},n.a.createElement(yt,null),n.a.createElement(Lt,null),n.a.createElement("div",{className:"chat-footer"},n.a.createElement(Rt,{id:"messageTextArea",onPressEnter:this.handleMessageEnter,rows:1,placeholder:"Type a new message",ref:"messageTextArea"}),n.a.createElement(Ke.a,{type:"primary",onClick:this.handleSendClick},"Send")))))}}]),t}(n.a.Component),_t=Object(d.b)((function(e){return{userName:e.userReducer.userName}}),(function(e){return{initialWebSocket:function(){return e(he())},closeWebSocket:function(){return e(fe())},loadChatContainer:function(t){return e(ve(t))},submitChatMessage:function(t){return e(function(e){var t=Bt.getState().chatReducer.currentSessionId,a=Bt.getState().chatReducer.waitingGroupUsernames;return Bt.getState().chatReducer.webSocket.json(de(t,e,a)),{type:V}}(t))}}}))(Dt);a(1075),a(1076),a(1077);a.d(t,"store",(function(){return Bt}));var Bt=Object(u.d)(Fe,Object(u.a)(l.a));window.store=Bt,C.post("/API/protected/ping").then((function(e){console.log("ping"),console.log(e)}),(function(e){console.log(e),console.log("not-ping"),y()}));var Ft=n.a.createElement(d.a,{store:Bt},n.a.createElement(c.a,null,n.a.createElement("div",{style:{overflow:"hidden"}},n.a.createElement(i.b,{exact:!0,path:"/login",component:Ze}),n.a.createElement(i.b,{exact:!0,path:"/",component:_t}))));o.a.render(Ft,document.getElementById("root"))},508:function(e,t,a){e.exports=a(1079)}},[[508,1,2]]]);
//# sourceMappingURL=main.890fc6a2.chunk.js.map
